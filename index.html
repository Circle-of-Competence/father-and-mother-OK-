<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPR å‡†çˆ¶æ¯å‡†å¤‡åº¦æ®‹é…·è¯„ä¼°ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #27ae60; /* æ²‰ç¨³ç»¿ï¼Œä»£è¡¨é€šè¿‡ */
            --danger: #e74c3c;    /* è­¦ç¤ºçº¢ */
            --accent: #8e44ad;    /* ç¥ç§˜ç´« */
            --bg: #f4f7f6;
            --card: #ffffff;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 40px 0;
        }

        .container {
            width: 90%;
            max-width: 900px;
            background: var(--card);
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            width: 0%;
            transition: width 0.4s ease;
        }

        h1 { text-align: center; margin-bottom: 10px; font-size: 2.2em; color: var(--primary); }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 40px; }

        /* Setup Phase */
        .setup-group label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 1.1em; }
        select { width: 100%; padding: 15px; border: 2px solid #bdc3c7; border-radius: 8px; font-size: 16px; margin-bottom: 25px; outline: none; transition: 0.3s; }
        select:focus { border-color: var(--accent); }

        /* Quiz Phase */
        .question-card { text-align: center; margin-top: 20px; animation: fadeIn 0.5s; }
        .question-text { font-size: 1.5em; font-weight: 600; margin-bottom: 30px; min-height: 90px; display: flex; align-items: center; justify-content: center; line-height: 1.4; }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.6em;
            border-radius: 4px;
            color: white;
            vertical-align: middle;
            margin-right: 10px;
            transform: translateY(-2px);
        }

        .options-grid { display: grid; gap: 15px; max-width: 600px; margin: 0 auto; }
        .option-btn {
            padding: 18px;
            border: 2px solid #ecf0f1;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
            font-weight: 500;
        }
        .option-btn:hover { border-color: var(--accent); background: #fdf5ff; transform: translateY(-3px); }

        /* Result Phase */
        #print-area { background: white; padding: 40px; }
        
        .result-header {
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .style-box {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 40px;
        }
        .style-title { font-size: 2.5em; font-weight: bold; margin-bottom: 10px; }
        .style-tag { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9em; }

        .radar-box {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .score-pill {
            background: #f8f9fa;
            border: 1px solid #eee;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .score-pill span { font-size: 1.4em; color: var(--accent); }

        /* å»ºè®®å¡ç‰‡ */
        .advice-list { display: flex; flex-direction: column; gap: 25px; }
        
        .advice-card {
            background: #fffcf5;
            border-left: 6px solid #f39c12;
            padding: 25px;
            border-radius: 6px;
            page-break-inside: avoid;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }
        
        .advice-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #d35400;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .advice-block { margin-bottom: 12px; line-height: 1.8; font-size: 0.95em; text-align: justify; }
        .tag { font-weight: bold; background: rgba(243, 156, 18, 0.15); padding: 2px 6px; border-radius: 4px; color: #d35400; margin-right: 5px; }

        /* æŒ‰é’® */
        .btn-main {
            width: 100%;
            padding: 18px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-main:hover { background: #732d91; transform: translateY(-2px); }
        .btn-outline { background: transparent; border: 2px solid var(--accent); color: var(--accent); margin-top: 10px; }
        .btn-outline:hover { background: #fbf4ff; }

        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="progress-container" id="progress-box">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div id="setup-phase">
        <h1>PPR çˆ¶æ¯èµ„æ ¼ä¸å‡†å¤‡åº¦æ®‹é…·è¯„ä¼°</h1>
        <div class="subtitle">è¿™ä¸ä»…ä»…æ˜¯ä¸ªæµ‹è¯•ï¼Œè¿™æ˜¯ç»™ä½ æœªæ¥å­©å­çš„ä¸€ä»½ä¿é™©</div>
        
        <div class="setup-group">
            <label>æ‚¨å½“å‰çš„è´¢åŠ¡ä¸ç”Ÿæ´»çŠ¶æ€ï¼š</label>
            <select id="finance-status">
                <option value="Stable">ç›¸å½“ç¨³å®š (æœ‰æˆ¿æœ‰ç§¯è“„ï¼ŒæŠ—é£é™©èƒ½åŠ›å¼º)</option>
                <option value="Growing">ä¸Šå‡æœŸ (æ”¶æ”¯å¹³è¡¡ï¼Œä½†æ€•çªå‘å¤§é¢æ”¯å‡º)</option>
                <option value="Tight">æœˆå…‰æ— (ä¸€äººåƒé¥±å…¨å®¶ä¸é¥¿ï¼Œå¤šäº†ä¸è¡Œ)</option>
                <option value="Chaos">æ··ä¹± (è¿˜æ²¡ææ¸…é’±å»å“ªäº†)</option>
            </select>
        </div>
        <div class="setup-group">
            <label>æ‚¨è¦å­©å­çš„æ ¸å¿ƒåŠ¨æœºï¼š</label>
            <select id="motivation">
                <option value="Love">ä»˜å‡ºçˆ± (æƒ³ä½“éªŒç”Ÿå‘½æˆé•¿çš„è¿‡ç¨‹)</option>
                <option value="Fix">ä¿®å¤å…³ç³» (è§‰å¾—æœ‰äº†å­©å­å©šå§»ä¼šæ›´ç¨³å›º)</option>
                <option value="Pressure">ç¤¾ä¼šå‹åŠ› (çˆ¶æ¯å‚¬/åŒé¾„äººéƒ½ç”Ÿäº†)</option>
                <option value="Pension">é˜²è€ (å…»å„¿é˜²è€ï¼ŒæŠ•èµ„å›æŠ¥)</option>
            </select>
        </div>
        <button class="btn-main" onclick="startQuiz()">é¢å¯¹ç°å®</button>
    </div>

    <div id="quiz-phase" class="hidden">
        <div class="question-card">
            <div id="q-text" class="question-text">åŠ è½½ä¸­...</div>
            <div class="options-grid"></div>
        </div>
    </div>

    <div id="result-phase" class="hidden">
        <div id="print-area">
            <div class="result-header">
                <h1>PPR çˆ¶æ¯èµ„æ ¼é‰´å®šä¹¦</h1>
                <p>é‰´å®šæ—¶é—´: <span id="report-date"></span></p>
            </div>

            <div class="style-box">
                <div class="style-title" id="final-archetype">åˆ†æä¸­...</div>
                <div class="style-tag" id="final-tag">...</div>
                <p id="final-desc" style="margin-top:20px; font-size:1.1em; opacity:0.9;">...</p>
            </div>

            <div class="radar-box">
                <div class="score-pill">ğŸ§  å¿ƒç†éŸ§æ€§ <span id="score-psy">0%</span></div>
                <div class="score-pill">ğŸ’° ç‰©è´¨åŸºç¡€ <span id="score-mat">0%</span></div>
                <div class="score-pill">ğŸ¤ ç¤¾ä¼šæ”¯æŒ <span id="score-soc">0%</span></div>
            </div>

            <h2>ğŸ’Š æ‚¨çš„â€œé¿å‘â€è¡ŒåŠ¨æ¸…å•</h2>
            <p style="color:#666; margin-bottom:20px;">å¦‚æœä»¥ä¸‹å»ºè®®è®©æ‚¨æ„Ÿåˆ°è¢«å†’çŠ¯ï¼Œé‚£ä¹ˆæ­å–œæ‚¨ï¼Œæˆ‘ä»¬æˆ³ä¸­äº†ç—›ç‚¹ï¼š</p>
            
            <div id="advice-container" class="advice-list">
                </div>
            
            <div style="margin-top:50px; text-align:center; font-size:0.8em; color:#999; border-top:1px solid #eee; padding-top:20px;">
                æœ¬æŠ¥å‘Šç”± PPR (Prospective Parent Readiness) ç®—æ³•å¼•æ“ç”Ÿæˆ Â· ä¸æ„æˆåŒ»ç–—å»ºè®®ï¼Œä½†æ„æˆç”Ÿå­˜å»ºè®®
            </div>
        </div>

        <button class="btn-main" onclick="downloadPDF()">â¬‡ï¸ ä¿å­˜è¯Šæ–­æŠ¥å‘Š (PDF)</button>
        <button class="btn-main btn-outline" onclick="location.reload()">â†º æˆ‘ä¸æœï¼Œé‡æµ‹</button>
    </div>
</div>

<script>
    /* domain: 
    - PSY: å¿ƒç† (Psychological)
    - MAT: ç‰©è´¨/ç°å® (Material)
    - SOC: ç¤¾äº¤/å…³ç³» (Social/Relational)
    
    optimalVal: 'high' (åº”é€‰åŒæ„/å®Œå…¨åŒæ„) / 'low' (åº”é€‰ä¸åŒæ„/å®Œå…¨ä¸åŒæ„)
    */
    const questions = [
        {
            text: "æˆ‘æ„¿æ„åœ¨æœªæ¥3-5å¹´å†…ï¼Œå½»åº•ç‰ºç‰²æ‰ç¡åˆ°è‡ªç„¶é†’ã€éšå«éšåˆ°çš„èšä¼šå’Œå®‰é™çš„å¦‚å•æ—¶é—´ã€‚",
            domain: 'PSY',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>ç°å®æš´å‡»</span> å¦‚æœæ‚¨è¿˜åœ¨ç¼…æ€€â€œè¯´èµ°å°±èµ°çš„æ—…è¡Œâ€ï¼Œè¯·èµ¶ç´§ä¹°å¼ æœºç¥¨å»ç©ï¼Œåˆ«ä¹°éªŒå­•æ£’ã€‚å­©å­å°±åƒä¸€å°æ²¡æœ‰â€œå…³æœºé”®â€ä¸”æ¼æ²¹çš„é™¤è‰æœºï¼Œä¼š24å°æ—¶ç¢¾å‹æ‚¨çš„ä¸ªäººç©ºé—´ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> è¯•ç€æ¯å¤©è°ƒé—¹é’Ÿåœ¨å‡Œæ™¨3ç‚¹èµ·åºŠï¼ŒæŠ±ç€ä¸€ä¸ªåæ–¤é‡çš„è¥¿ç“œèµ°åŠ¨ä¸€å°æ—¶ï¼ŒåšæŒä¸€å‘¨ã€‚å¦‚æœæ‚¨è§‰å¾—è¿™å¾ˆé…·ï¼Œé‚£æ‚¨è¿‡å…³äº†ã€‚</div>"
        },
        {
            text: "æˆ‘è®¤ä¸ºå­©å­çš„åˆ°æ¥èƒ½ä¿®è¡¥æˆ‘å’Œä¼´ä¾£ä¹‹é—´ç›®å‰çš„è£‚ç—•ï¼Œè®©æˆ‘ä»¬æ›´äº²å¯†ã€‚",
            domain: 'SOC',
            optimalVal: 'low', // è¿™æ˜¯ä¸€ä¸ªé™·é˜±é¢˜
            advice: "<div class='advice-block'><span class='tag'>çº¢è‰²è­¦æŠ¥</span> å­©å­ä¸æ˜¯å©šå§»çš„èƒ¶æ°´ï¼Œå­©å­æ˜¯å©šå§»çš„â€œå‹åŠ›æµ‹è¯•ä»ªâ€å’Œâ€œç…§å¦–é•œâ€ã€‚å¦‚æœä½ ä»¬ç°åœ¨ä¸ºäº†æ´—ç¢—åµæ¶ï¼Œæœ‰äº†å­©å­åï¼Œä½ ä»¬ä¼šä¸ºäº†è°å»æ¢é‚£ä¸ªå……æ»¡æ”¾å°„æ€§æ°”å‘³çš„å°¿å¸ƒè€Œæ‰“ç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> å…ˆå»æŠŠå©šç»“æ˜ç™½ï¼Œæˆ–è€…æŠŠæ¶åµæ˜ç™½ã€‚åœ¨å…³ç³»ç¨³å›ºä¹‹å‰ç”Ÿå­©å­ï¼Œé€šå¸¸æ˜¯å•äº²å®¶åº­çš„é¢„å¤‡åŠ¨ä½œã€‚</div>"
        },
        {
            text: "æˆ‘æœ‰è¶³å¤Ÿçš„å­˜æ¬¾ï¼Œå³ä½¿æˆ‘å’Œä¼´ä¾£å…¶ä¸­ä¸€äººå¤±ä¸šåŠå¹´ï¼Œä¹Ÿèƒ½ç»´æŒå®¶åº­è¿è½¬ã€‚",
            domain: 'MAT',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>æ‰å¿ƒåæ§½</span> æ‰€è°“â€œç©·æœ‰ç©·å…»â€ï¼Œé€šå¸¸æ˜¯æ²¡ç»å†è¿‡åŠå¤œå‘çƒ§å»åŒ»é™¢æ’é˜Ÿã€æˆ–è€…çœ‹ç€å­¦åŒºæˆ¿æˆ¿ä»·å¹æ°”çš„äººè¯´çš„ã€‚é‡‘é’±ä¹°ä¸æ¥çˆ±ï¼Œä½†èƒ½ä¹°æ¥ä½œä¸ºçˆ¶æ¯æœ€éœ€è¦çš„ä¸œè¥¿ï¼š**å¿ƒæ€çš„ä»å®¹**ã€‚</div><div class='advice-block'><span class='tag'>æ½œåœ¨åæœ</span> è´«è´±å¤«å¦»ç™¾äº‹å“€ï¼Œç”±äºç»æµå‹åŠ›å¯¼è‡´çš„å®¶åº­äº‰åµï¼Œæ˜¯å­©å­å¿ƒç†é˜´å½±çš„ä¸»è¦æ¥æºä¹‹ä¸€ã€‚</div>"
        },
        {
            text: "å½“çœ‹åˆ°åˆ«äººçš„å­©å­åœ¨é¤å…å°–å«æ‰“æ»šæ—¶ï¼Œæˆ‘ä¸ä»…ä¸ä¼šåŒæ¶ï¼Œè¿˜èƒ½ç†è§£è¿™æ˜¯å‘å±•çš„æ­£å¸¸é˜¶æ®µã€‚",
            domain: 'PSY',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>å¿ƒç†ä¾§å†™</span> å¦‚æœæ‚¨ç°åœ¨çœ‹åˆ°ç†Šå­©å­åªæƒ³ç¿»ç™½çœ¼ï¼Œé‚£ç­‰æ‚¨è‡ªå·±æœ‰äº†å­©å­ï¼Œæ‚¨å¯èƒ½ä¼šæˆä¸ºé‚£ç§åœ¨è¶…å¸‚é‡Œå¯¹ç€å­©å­å’†å“®çš„å¤±æ§å®¶é•¿ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> æ‚¨çš„å­©å­ä¸€å®šä¼šåœ¨æœ€ä¸åˆé€‚çš„åœºåˆï¼ˆæ¯”å¦‚è€æ¿ä¹Ÿåœ¨çš„é¤å…ï¼‰è®©æ‚¨ä¸¢è„¸ã€‚è¯·æå‰ç»ƒä¹ â€œåšè„¸çš®ç¥åŠŸâ€å’Œâ€œæ¸©å’Œåšå®šåœ°æŠ±ç¦»ç°åœºâ€æŠ€èƒ½ã€‚</div>"
        },
        {
            text: "æˆ‘å·²ç»åšå¥½äº†å¿ƒç†å‡†å¤‡ï¼Œæ¥å—æˆ‘çš„å­©å­å¯èƒ½æ˜¯ä¸€ä¸ªæå…¶æ™®é€šã€ç”šè‡³å¹³åº¸çš„äººã€‚",
            domain: 'PSY',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>æ‰å¿ƒåæ§½</span> æ‰¿è®¤å§ï¼Œæˆ‘ä»¬å¤§å¤šæ•°äººéƒ½æ˜¯NPCã€‚å¦‚æœæ‚¨ç”Ÿå­©å­çš„ç›®çš„æ˜¯ä¸ºäº†ç»ƒä¸ªâ€œæ»¡çº§å°å·â€æ¥å®ç°æ‚¨çš„æ¸…åæ¢¦ï¼Œè¯·å»ç©RPGæ¸¸æˆã€‚é€¼è¿«ä¸€ä¸ªæ™®é€šå­©å­æˆä¸ºå¤©æ‰ï¼Œæ˜¯ä¸œäºšå®¶åº­æœ€å¤§çš„æ‚²å‰§æ¥æºã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> è¯·å¯¹ç€é•œå­å¿µä¸‰éï¼šâ€œæˆ‘çš„å­©å­å¯èƒ½æ•°å­¦ä¸åŠæ ¼ï¼Œä½†è¿™ä¸å½±å“æˆ‘çˆ±ä»–/å¥¹ã€‚â€</div>"
        },
        {
            text: "æˆ‘çš„çˆ¶æ¯æˆ–å…¬å©†æ„¿æ„å¹¶æœ‰èƒ½åŠ›æä¾›è‚²å„¿æ”¯æŒï¼Œä¸”æˆ‘ä»¬åœ¨è¿™ä¸ªé—®é¢˜ä¸Šè¾¾æˆäº†ä¸€è‡´ã€‚",
            domain: 'SOC',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>ç°å®æš´å‡»</span> â€œé‚£æ˜¯æˆ‘çš„å­©å­ï¼Œæˆ‘è‡ªå·±å¸¦ï¼â€è¿™è¯å¬ç€ç¡¬æ°”ï¼Œä½†åœ¨æ‚¨è¿ç»­ç†¬å¤œ30å¤©åï¼Œæ‚¨ä¼šè·ªç€æ±‚éš”å£ç‹å¤§å¦ˆå¸®å¿™çœ‹ä¸€åˆ†é’Ÿã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> è‚²å„¿éœ€è¦ä¸€ä¸ªæ‘åº„ã€‚å¦‚æœæ²¡æœ‰è€äººå¸®å¿™ï¼Œè¯·ç¡®è®¤æ‚¨çš„é“¶è¡Œå¡ä½™é¢è¶³å¤Ÿé›‡ä½£é è°±çš„è‚²å„¿å«‚ã€‚å­¤å†›å¥‹æˆ˜çš„çˆ¶æ¯é€šå¸¸ç¦»æŠ‘éƒç—‡åªæœ‰ä¸€æ­¥ä¹‹é¥ã€‚</div>"
        },
        {
            text: "æˆ‘è®¤ä¸ºâ€œå¬è¯â€æ˜¯å¥½å­©å­æœ€é‡è¦çš„å“è´¨ï¼Œå®¶é•¿å¿…é¡»æœ‰ç»å¯¹æƒå¨ã€‚",
            domain: 'PSY',
            optimalVal: 'low',
            advice: "<div class='advice-block'><span class='tag'>è§‚å¿µæ’æ¯’</span> æ‚¨æƒ³å…»çš„æ˜¯å­©å­è¿˜æ˜¯å® ç‰©ï¼Ÿåœ¨è¿™ä¸ªAIæ—¶ä»£ï¼Œåªä¼šâ€œå¬è¯â€çš„å­©å­æ˜¯æœ€å®¹æ˜“è¢«æ›¿ä»£çš„ã€‚ç»å¯¹æƒå¨å¸¦æ¥çš„æ˜¯ç»å¯¹çš„å›é€†æˆ–ç»å¯¹çš„æ‡¦å¼±ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> å¦‚æœæ‚¨æ§åˆ¶æ¬²çˆ†æ£šï¼Œå»ºè®®å…»ç‹—ã€‚å…»äººéœ€è¦çš„æ˜¯â€œå›­ä¸â€å¿ƒæ€ï¼ˆæä¾›ç¯å¢ƒï¼‰ï¼Œè€Œä¸æ˜¯â€œæœ¨åŒ â€å¿ƒæ€ï¼ˆæŒ‰å›¾çº¸åˆ‡å‰²ï¼‰ã€‚</div>"
        },
        {
            text: "å½“ä¼´ä¾£åœ¨è‚²å„¿æ–¹å¼ä¸Šå’Œæˆ‘æœ‰åˆ†æ­§æ—¶ï¼Œæˆ‘æœ‰ä¿¡å¿ƒæˆ‘ä»¬èƒ½å†·é™åå•†ï¼Œè€Œä¸æ˜¯å†·æˆ˜æˆ–äº’ç›¸æŒ‡è´£ã€‚",
            domain: 'SOC',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>æ‰å¿ƒåæ§½</span> çŒªé˜Ÿå‹ä¹‹æ‰€ä»¥æ˜¯çŒªé˜Ÿå‹ï¼Œå¾€å¾€ä¸æ˜¯å› ä¸ºä»–/å¥¹ç¬¨ï¼Œè€Œæ˜¯å› ä¸ºä½ ä»¬çš„æ²Ÿé€šæœºåˆ¶æ˜¯â€œæŒ‡è´£å‹â€çš„ã€‚åœ¨å‡Œæ™¨ä¸¤ç‚¹çš„å©´å„¿å“­å£°ä¸­ï¼Œä»»ä½•å¾®å°çš„åˆ†æ­§éƒ½ä¼šè¢«æ”¾å¤§æˆåŸåˆ™é—®é¢˜ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> ç°åœ¨å°±å»ºç«‹â€œåœæˆ˜åè®®â€ã€‚çº¦å®šå¥½è°æ˜¯çº¢è„¸è°æ˜¯ç™½è„¸ï¼Œæˆ–è€…åœ¨æƒ…ç»ªä¸Šå¤´æ—¶å…ˆé—­å˜´10åˆ†é’Ÿã€‚</div>"
        },
        {
            text: "æˆ‘èƒ½æ¥å—å®¶é‡Œé•¿æœŸå¤„äºâ€œä¹±ç³Ÿç³Ÿâ€çš„çŠ¶æ€ï¼Œåœ°æ¿ä¸Šæœ‰ç©å…·ï¼Œå¢™ä¸Šæœ‰æ¶‚é¸¦ã€‚",
            domain: 'MAT',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>æ´ç™–é¢„è­¦</span> å¯¹äºæœ‰æ´ç™–çš„äººæ¥è¯´ï¼Œå­©å­å°±æ˜¯è¡Œèµ°çš„é«˜ç†µä½“ã€‚å¦‚æœæ‚¨å› ä¸ºåœ°æ¿ä¸Šæœ‰ä¸€æ»´å¥¶æ¸å°±æŠ“ç‹‚ï¼Œæ‚¨çš„ç²¾ç¥çŠ¶æ€ä¼šæ—¶åˆ»å¤„äºå´©æºƒè¾¹ç¼˜ï¼Œå­©å­ä¹Ÿä¼šæ´»å¾—æˆ˜æˆ˜å…¢å…¢ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> æ”¾å¼ƒâ€œæ ·æ¿é—´â€çš„å¹»æƒ³ã€‚æŠŠâ€œæ•´æ´â€çš„æ ‡å‡†ä»â€œä¸€å°˜ä¸æŸ“â€é™ä½åˆ°â€œæ²¡æœ‰ç”Ÿç‰©å±å®³â€ã€‚</div>"
        },
        {
            text: "æˆ‘ç”Ÿå­©å­ä¸æ˜¯ä¸ºäº†è®©ä»–ç»™æˆ‘å…»è€ï¼Œæˆ–è€…å®Œæˆæˆ‘æœªç«Ÿçš„æ¢¦æƒ³ã€‚",
            domain: 'PSY',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>æ‰å¿ƒåæ§½</span> ä»»ä½•æŠ±ç€â€œæŠ•èµ„å›æŠ¥â€å¿ƒæ€ç”Ÿå­©å­çš„äººï¼Œæœ€åéƒ½ä¼šäºå¾—åº•è£¤éƒ½ä¸å‰©ã€‚ç°ä»£è‚²å„¿æ˜¯ä¸€é¡¹é«˜æŠ•å…¥ã€é›¶é‡‘é’±å›æŠ¥ã€ä¸”å¤§æ¦‚ç‡è¢«å­©å­å«Œå¼ƒçš„â€œæ…ˆå–„äº‹ä¸šâ€ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> æ‚¨çš„å…»è€é‡‘é ç¤¾ä¿å’Œç†è´¢ï¼Œåˆ«é å­©å­ã€‚çˆ±ä»–ï¼Œä»…ä»…å› ä¸ºä»–æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç”Ÿå‘½ï¼Œè€Œä¸æ˜¯æ‚¨çš„ç»­é›†ã€‚</div>"
        },
        {
            text: "å¦‚æœå­©å­ç”Ÿç—…ã€å­¦æ ¡æœ‰äº‹ï¼Œæˆ‘çš„å·¥ä½œå…è®¸æˆ‘è¾ƒä¸ºçµæ´»åœ°è¯·å‡å¤„ç†ã€‚",
            domain: 'MAT',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>èŒåœºç°å®</span> å­©å­ä¸ä¼šæŒ‘å‘¨æœ«ç”Ÿç—…ã€‚å¦‚æœæ‚¨åœ¨ä¸€å®¶â€œä¸Šå•æ‰€éƒ½è¦æ‰“æŠ¥å‘Šâ€çš„å…¬å¸ï¼Œæˆ–è€…æ‚¨çš„èŒä½å®¹ä¸å¾—åŠç‚¹åˆ†å¿ƒï¼Œé‚£ä¹ˆâ€œç”±äºè‚²å„¿å¯¼è‡´çš„èŒä¸šå±æœºâ€å¾ˆå¿«å°±ä¼šåˆ°æ¥ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> è¯„ä¼°ä¸€ä¸‹èŒä¸šèµ›é“ã€‚æœ‰æ—¶å€™ï¼Œä¸ºäº†å­©å­æ¢ä¸€ä¸ªé’±å°‘ç‚¹ä½†äº‹å°‘ç‚¹çš„å·¥ä½œï¼Œä¸æ˜¯è®¤æ€‚ï¼Œæ˜¯æˆ˜ç•¥è°ƒæ•´ã€‚</div>"
        },
        {
            text: "æˆ‘å·²ç»å¤„ç†å¥½äº†è‡ªå·±çš„åŸç”Ÿå®¶åº­åˆ›ä¼¤ï¼Œä¸ä¼šæ— æ„è¯†åœ°æŠŠå®ƒæŠ•å°„ç»™å­©å­ã€‚",
            domain: 'PSY',
            optimalVal: 'high',
            advice: "<div class='advice-block'><span class='tag'>çµé­‚æ‹·é—®</span> è®¸å¤šäººè¯´â€œæˆ‘ç»ä¸åƒæˆ‘çˆ¸/å¦ˆé‚£æ ·å¯¹å¾…å­©å­â€ï¼Œç»“æœåœ¨æƒ…ç»ªå¤±æ§çš„é‚£ä¸€åˆ»ï¼Œå‘ç°è‡ªå·±ç®€ç›´å°±æ˜¯çˆ¶æ¯çš„å…‹éš†ä½“ã€‚æœªç»ç–—æ„ˆçš„åˆ›ä¼¤ä¼šä»£ä»£ç›¸ä¼ ã€‚</div><div class='advice-block'><span class='tag'>è¡ŒåŠ¨æŒ‡å—</span> å…ˆåšè‡ªå·±çš„çˆ¶æ¯ï¼ŒæŠŠè‡ªå·±é‡æ–°å…»ä¸€éã€‚åœ¨æŠŠä¸€ä¸ªæ— è¾œçš„ç”Ÿå‘½å¸¦åˆ°ä¸–ç•Œä¸Šä¹‹å‰ï¼Œè¯·å…ˆæ¸…ç†å¥½å¿ƒçµçš„åƒåœ¾åœºã€‚</div>"
        }
    ];

    /* ================= é€»è¾‘æ§åˆ¶ ================= */
    let currentIdx = 0;
    let scores = { PSY: 0, MAT: 0, SOC: 0 };
    let counts = { PSY: 0, MAT: 0, SOC: 0 };
    let collectedAdvice = [];
    
    document.getElementById('report-date').innerText = new Date().toLocaleDateString();

    function startQuiz() {
        document.getElementById('setup-phase').classList.add('hidden');
        document.getElementById('quiz-phase').classList.remove('hidden');
        document.getElementById('progress-box').classList.remove('hidden');
        showQuestion(0);
    }

    function showQuestion(idx) {
        if (idx >= questions.length) {
            finishQuiz();
            return;
        }

        const q = questions[idx];
        const pct = ((idx) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${pct}%`;

        // å¾½ç« é¢œè‰²
        let badgeColor = "#3498db";
        if(q.domain === 'MAT') badgeColor = "#f1c40f"; // é»„è‰²
        if(q.domain === 'SOC') badgeColor = "#e74c3c"; // çº¢è‰²
        
        let badgeText = q.domain === 'PSY' ? 'å¿ƒç†å‡†å¤‡' : (q.domain === 'MAT' ? 'ç‰©è´¨ç°å®' : 'ç¤¾ä¼šå…³ç³»');
        
        document.getElementById('q-text').innerHTML = 
            `<span class="badge" style="background:${badgeColor}">${badgeText}</span><br>${q.text}`;
        
        const optsDiv = document.querySelector('.options-grid');
        optsDiv.innerHTML = '';
        const labels = ["å®Œå…¨ä¸åŒæ„", "ä¸åŒæ„", "ä¸­ç«‹", "åŒæ„", "å®Œå…¨åŒæ„"];
        
        labels.forEach((label, val) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = label;
            btn.onclick = (e) => handleAnswer(val, e);
            optsDiv.appendChild(btn);
        });
    }

    function handleAnswer(val, event) {
        fireConfetti(event.clientX, event.clientY);
        
        const q = questions[currentIdx];
        
        // è®¡åˆ†é€»è¾‘
        // å¦‚æœ optimalVal æ˜¯ high (4åˆ†æœ€å¥½)ï¼Œåˆ™ val ç›´æ¥åŠ åˆ†
        // å¦‚æœ optimalVal æ˜¯ low (0åˆ†æœ€å¥½)ï¼Œåˆ™ (4-val) åŠ åˆ†
        let scoreToAdd = (q.optimalVal === 'high') ? val : (4 - val);
        
        scores[q.domain] += scoreToAdd;
        counts[q.domain] += 4; // æ¯é¢˜æ»¡åˆ†4

        // å»ºè®®è§¦å‘æœºåˆ¶ (åªè¦ä¸æ˜¯é€‰äº†æœ€ä¼˜çš„é‚£ä¸¤æ¡£ï¼Œå°±è§¦å‘å»ºè®®)
        let triggerAdvice = false;
        if (q.optimalVal === 'high' && val <= 2) triggerAdvice = true;
        if (q.optimalVal === 'low' && val >= 2) triggerAdvice = true;

        if (triggerAdvice) {
            collectedAdvice.push({
                domain: q.domain,
                text: q.advice
            });
        }

        currentIdx++;
        
        // UIåé¦ˆ
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');
        event.target.style.background = '#e8f8f5';
        event.target.style.borderColor = '#2ecc71';

        setTimeout(() => showQuestion(currentIdx), 350);
    }

    function finishQuiz() {
        document.getElementById('quiz-phase').classList.add('hidden');
        document.getElementById('progress-box').classList.add('hidden');
        document.getElementById('result-phase').classList.remove('hidden');

        // è®¡ç®—å„ç»´åº¦ç™¾åˆ†æ¯”
        const psyPct = Math.round((scores.PSY / counts.PSY) * 100) || 0;
        const matPct = Math.round((scores.MAT / counts.MAT) * 100) || 0;
        const socPct = Math.round((scores.SOC / counts.SOC) * 100) || 0;
        const totalPct = Math.round(((scores.PSY + scores.MAT + scores.SOC) / (counts.PSY + counts.MAT + counts.SOC)) * 100);

        document.getElementById('score-psy').innerText = psyPct + "%";
        document.getElementById('score-mat').innerText = matPct + "%";
        document.getElementById('score-soc').innerText = socPct + "%";

        // é£æ ¼/ç»“æœåˆ¤å®š
        let archetype = "";
        let tag = "";
        let desc = "";

        if (totalPct >= 85) {
            archetype = "å…­è¾¹å½¢æˆ˜å£« (The Ready Warrior)";
            tag = "æå…¶ç¨€æœ‰çš„åˆæ ¼çˆ¶æ¯é¢„å¤‡å½¹";
            desc = "æ‚¨çš„å¿ƒç†ã€é’±åŒ…å’Œé˜Ÿå‹éƒ½å·²å°±ä½ã€‚æ‚¨å¯¹è‚²å„¿çš„æ®‹é…·æ€§æœ‰æ¸…é†’çš„è®¤çŸ¥ï¼Œä¸”å¹¶æœªè¢«å“è·‘ã€‚è¯·ä¿æŒè¿™ä»½æ¸…é†’ï¼Œå­©å­ä¼šæ„Ÿè°¢æ‚¨çš„ã€‚";
        } else if (totalPct >= 65) {
            archetype = "ç†æ€§çš„èµŒå¾’ (The Cautious Planner)";
            tag = "åŠæ ¼ï¼Œä½†é£é™©å°šå­˜";
            desc = "æ‚¨å¤§ä½“ä¸Šå‡†å¤‡å¥½äº†ï¼Œä½†åœ¨æŸäº›å…³é”®é¢†åŸŸï¼ˆå¯èƒ½æ˜¯é’±ï¼Œå¯èƒ½æ˜¯å¿ƒæ€ï¼‰è¿˜å­˜åœ¨çŸ­æ¿ã€‚å­©å­ç”Ÿä¸‹æ¥èƒ½å…»æ´»ï¼Œä½†è¿‡ç¨‹å¯èƒ½ä¼šæ¯”æ‚¨é¢„æœŸçš„é¸¡é£ç‹—è·³ä¸€äº›ã€‚";
        } else if (totalPct >= 45) {
            archetype = "ç›²ç›®çš„å‹‡è€… (The Dreamer)";
            tag = "ä»…å‡­ä¸€è…”çƒ­è¡€æ˜¯å±é™©çš„";
            desc = "æ‚¨æŠŠè‚²å„¿æƒ³å¾—å¤ªç®€å•äº†ã€‚è¦ä¹ˆæ˜¯é«˜ä¼°äº†è‡ªå·±çš„è€å¿ƒï¼Œè¦ä¹ˆæ˜¯ä½ä¼°äº†é’ç¥¨çš„ç‡ƒçƒ§é€Ÿåº¦ã€‚å»ºè®®å…ˆä¹°ä¸ªä»™äººæŒç»ƒç»ƒæ‰‹ï¼Œæˆ–è€…å­˜å¤Ÿé’±å†æ¥ã€‚";
        } else {
            archetype = "è‡ªç”±çš„çµé­‚ (The Freedom Spirit)";
            tag = "è¯·æ”¾è¿‡å­©å­ï¼Œä¹Ÿæ”¾è¿‡è‡ªå·±";
            desc = "æ­¤æ—¶æ­¤åˆ»ï¼Œæ‚¨æœ€é€‚åˆåšçš„å°±æ˜¯â€”â€”äº«å—å•èº«/äºŒäººä¸–ç•Œï¼æ‚¨è¿˜æ²¡å‡†å¤‡å¥½ä¸ºä¸€ä¸ªç”Ÿå‘½è´Ÿè´£ï¼Œè¿™ä¸å¯è€»ï¼Œå¼ºè¡Œç”Ÿæ‰å¯è€»ã€‚";
        }

        document.getElementById('final-archetype').innerText = archetype;
        document.getElementById('final-tag').innerText = tag;
        document.getElementById('final-desc').innerText = desc;

        // ç”Ÿæˆå»ºè®®åˆ—è¡¨
        const container = document.getElementById('advice-container');
        container.innerHTML = "";

        // 1. æ’å…¥åŠ¨æœºè­¦å‘Š (Setup Phase Logic)
        const motivation = document.getElementById('motivation').value;
        if (motivation === 'Fix' || motivation === 'Pressure' || motivation === 'Pension') {
            let warnText = "";
            if(motivation === 'Fix') warnText = "æ‚¨é€‰æ‹©äº†â€˜ä¿®å¤å…³ç³»â€™ä½œä¸ºåŠ¨æœºã€‚è¿™æ˜¯è‚²å„¿ç•Œæœ€å¤§çš„èµŒåšï¼Œä¸”èƒœç‡å‡ ä¹ä¸ºé›¶ã€‚è¯·å…ˆä¿®å¤å…³ç³»ï¼Œå†ç”Ÿå­©å­ã€‚";
            if(motivation === 'Pressure') warnText = "æ‚¨æ˜¯å› ä¸ºâ€˜å‹åŠ›â€™æ‰ç”Ÿçš„ï¼Ÿå“ªæ€•æ‰€æœ‰äººéƒ½åœ¨å‚¬æ‚¨ï¼Œæœ€ååŠå¤œèµ·æ¥å–‚å¥¶çš„åªæœ‰æ‚¨è‡ªå·±ã€‚åˆ«ä¸ºåˆ«äººçš„æœŸå¾…ä¹°å•ã€‚";
            if(motivation === 'Pension') warnText = "â€˜å…»å„¿é˜²è€â€™ï¼Ÿç°åœ¨çš„è¡Œæƒ…æ˜¯â€˜å…»å„¿å•ƒè€â€™ã€‚è¯·è°ƒæ•´é¢„æœŸï¼ŒæŠŠçˆ±å˜å¾—çº¯ç²¹ä¸€ç‚¹ã€‚";

            const motivDiv = document.createElement('div');
            motivDiv.className = 'advice-card';
            motivDiv.style.borderLeftColor = '#e74c3c';
            motivDiv.innerHTML = `<div class='advice-header'>ğŸš« åŠ¨æœºç†”æ–­è­¦å‘Š</div><div class='advice-block'>${warnText}</div>`;
            container.appendChild(motivDiv);
        }

        // 2. æ’å…¥ç­”é¢˜ç”Ÿæˆçš„å»ºè®®
        if (collectedAdvice.length === 0 && totalPct > 80) {
            const perfectDiv = document.createElement('div');
            perfectDiv.className = 'advice-card';
            perfectDiv.style.borderLeftColor = '#27ae60';
            perfectDiv.innerHTML = `<div class='advice-header'>ğŸ‰ å‡†å¤‡å……åˆ†</div><div class='advice-block'>æ‚¨çš„è®¤çŸ¥éå¸¸æ¸…æ™°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ€ç»´é›·åŒºã€‚ä¿æŒè¿™ä»½ç†æ€§ï¼Œè¿æ¥å°æ€ªå…½çš„åˆ°æ¥å§ï¼</div>`;
            container.appendChild(perfectDiv);
        } else {
            collectedAdvice.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'advice-card';
                // æ ¹æ®domainè®¾ç½®é¢œè‰²æ¡
                let color = '#f39c12';
                if(item.domain === 'PSY') color = '#3498db';
                if(item.domain === 'SOC') color = '#e74c3c';
                div.style.borderLeftColor = color;
                
                div.innerHTML = `<div class='advice-header'>ğŸ” é£é™©ç‚¹ #${i+1}</div>` + item.text;
                container.appendChild(div);
            });
        }
    }

    function fireConfetti(x, y) {
        const xNorm = x / window.innerWidth;
        const yNorm = y / window.innerHeight;
        confetti({
            particleCount: 30, spread: 40, origin: { x: xNorm, y: yNorm },
            colors: ['#2ecc71', '#3498db', '#9b59b6'],
            disableForReducedMotion: true
        });
    }

    window.downloadPDF = async function() {
        const element = document.getElementById('print-area');
        const btn = document.querySelector('.btn-main');
        const originalText = btn.innerText;
        btn.innerText = "â³ æ­£åœ¨ç”Ÿæˆ...";
        btn.disabled = true;

        try {
            window.scrollTo(0,0);
            const canvas = await html2canvas(element, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff'
            });

            const imgData = canvas.toDataURL('image/jpeg', 0.98);
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const imgProps = pdf.getImageProperties(imgData);
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            
            // ç®€å•çš„é•¿å›¾å¤„ç†
            let heightLeft = pdfHeight;
            let position = 0;
            const pageHeight = pdf.internal.pageSize.getHeight();

            pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, pdfHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - pdfHeight;
                pdf.addPage();
                pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, pdfHeight);
                heightLeft -= pageHeight;
            }

            pdf.save('PPR_å‡†çˆ¶æ¯èµ„æ ¼é‰´å®šä¹¦.pdf');

        } catch (err) {
            console.error(err);
            alert("ç”ŸæˆPDFé‡åˆ°é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦æ‰“å°åŠŸèƒ½(Ctrl+P)ä¿å­˜ã€‚");
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
